<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QR Code 掃描器</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h2>掃描 QR Code</h2>
  <div id="reader" style="width:300px;"></div>
  <p>掃描結果：<span id="result"></span></p>

  <script>
    // 這裡換成你的 Apps Script Web App URL
    const apiUrl = "https://script.google.com/a/macros/andst.co.jp/s/AKfycbyz2IaF6C2NSZls15e5PLqSLFiqWY8oqIVlQF32UOUlFUF45Vom6OjfcLtQa6bvWoHt/exec";

    function onScanSuccess(qrMessage) {
      document.getElementById("result").innerText = qrMessage;

      fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ qr: qrMessage })
      })
      .then(res => res.text())
      .then(txt => {
        console.log("伺服器回應:", txt);
        alert("伺服器回應: " + txt); // 方便測試
      })
      .catch(err => {
        console.error("錯誤:", err);
        alert("傳送失敗: " + err);
      });
    }

    let html5QrCode = new Html5Qrcode("reader");
    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        html5QrCode.start(
          devices[0].id,
          { fps: 10, qrbox: 250 },
          onScanSuccess
        );
      }
    }).catch(err => console.error("相機錯誤:", err));
  </script>
</body>
</html>
